<div class="container-fluid">
    <div class="row">
        <div class="col-sm-2">
            <div class="nav flex-column nav-pills" id="nav-tab" role="tablist" aria-orientation="vertical">
                <a class="nav-link zakladne-tab active" id="zakladne-tab" data-toggle="pill" href="#zakladne" role="tab" aria-controls="v-pills-home" aria-selected="true">Základné údaje</a>
                <a class="nav-link slova-tab" id="rodicia-tab" data-toggle="pill" href="#rodicia" role="tab" aria-controls="v-pills-messages" aria-selected="false">Rodičia</a>
                <a class="nav-link slova-tab" id="atributy-tab" data-toggle="pill" href="#atributy" role="tab" aria-controls="v-pills-messages" aria-selected="false">Atribúty</a>
            </div>
        </div>
        <div class="col-sm-10">
            <div class="tab-content" id="nav-tabContent">
                  <div class="tab-pane fade active show" id="zakladne" role="tabpanel" aria-labelledby="zakladne-tab"
                       data-target="{{url_for('koncept.kc_zakladne_info')}}?kc_id=">
                  </div>
                  <div class="tab-pane fade" id="rodicia" role="tabpanel" aria-labelledby="rodicia-tab"
                       data-target="{{url_for('koncept.kc_rodicia_konceptu')}}?kc_id=">
                  </div>
                  <div class="tab-pane fade" id="atributy" role="tabpanel" aria-labelledby="atributy-tab"
                       data-target="{{url_for('koncept.kc_atributy')}}?kc_id=">
                  </div>
            </div>
        </div>
    </div>
</div>
</div>
<input type="hidden" id="hdn_KC_ID" value="0"/>
<input type="hidden" id="hdn_Povodne_KC_ID" value="0"/>
<script>

    var loadnuteTaby = {};

    function NastavUlozButton(tab){
            var $modal =  $('#nav-tab').parents('.modal');

            if (tab == "atributy"){
                var $btnSave = $modal.find('.btnSave').removeClass('nodisplay').html("<i class='fa fa-save'></i>&nbsp;Uložiť");
            }
            else{
                var $btnSave = $modal.find('.btnSave').html("<i class='fa fa-save'></i>&nbsp;Ďalej >>");
            }
    }

    function setPovodneKC_ID(id){
        $('#hdn_Povodne_KC_ID').val(id);
    }

    function getPovodneKC_ID(){
        return $('#hdn_Povodne_KC_ID').val();
    }

    function setKC_ID(id){
        $('#hdn_KC_ID').val(id);
    }

    function getKC_ID(){
        return $('#hdn_KC_ID').val();
    }

    var currentTab = {};

    function reloadActiveTab() {
        var selected = $('#nav-tab a.active');
        selected.trigger("click");
    }

    function activateTab(cssClass) {
        var tabObj = $('#nav-tab .' + cssClass);
        tabObj.trigger("click");
    }

    function show_tab(tab) {
        var selected = $(currentTab).attr('id');
        $('.btnSave').focus();

        if (selected=="zakladne"){
            if (loadnuteTaby["zakladne"]){

                if (!ZmenKCZakladneInfo()){
                    return;
                }
            }
        }

        if (loadnuteTaby[$(tab).attr('id')]){
            NastavUlozButton($(tab).attr('id'));
        }
        else{
            loadnuteTaby[$(tab).attr('id')] = true;
            tab.html('<i class="fa fa-spinner fa-spin fa-lg"></i>');
            tab.load(tab.attr('data-target')+getKC_ID());

            NastavUlozButton($(tab).attr('id'));
        }

        currentTab = tab;
    }

    function load_default_tab() {
        var tab = $('#nav-tab .active');
        tab.tab('show');
        currentTab = tab;
        show_tab($(tab.attr('href')));
    }

    function init_tabs() {
        load_default_tab();
    }

     function init_click() {
         $('#nav-tab a').click(function (e) {
             e.preventDefault();
             var id = $(this).attr('href').substr(1);
             var tabObj = $(this);
             tabObj.tab('show');
             var tab = $('#' + id);
             show_tab(tab);
            });
     }

    function load_kc_id(){
        AjaxMethods.getDataFromGetRequest('{{url_for("sd.vrat_sd_id")}}', "",
            '?sd_id={{request.args.get("sd_id")}}&slovo={{request.args.get("slovo")}}&slovnyDruh={{request.args.get("slovnyDruh")}}', function(r){
            if (r.status==responseOK){//OK vetva
                if ('{{request.args.get("ulozAkoNoveSlovo")}}' == 'true'){
                    setPovodneSD_ID(r.data);
                    setSD_ID(0);
                }
                else
                    setSD_ID(r.data);
            } else{
                   swal({ buttons: {},
                       title  :  "Chyba",
                       text   :  r.message_text,
                       icon   :  "error"})
            }
        });
    }

$(document).ready(function() {
    var $modal =  $('#nav-tab').parents('.modal');
    $modal.find('.btnCancel').removeClass('nodisplay');
    var $btnSave = $modal.find('.btnSave').removeClass('nodisplay').html("<i class='fa fa-save'></i>&nbsp;Ďalej >>");
    $btnSave.unbind("click");
    $btnSave.click(function() {
        DalsiTab();
    });

    if ('{{request.args.get("kc_id")}}'!="None"){
        if ('{{request.args.get("ulozAkoNovyKoncept")}}' == 'true'){
            setPovodneKC_ID('{{request.args.get("kc_id")}}');
            setKC_ID(0);
        }
        else
            setKC_ID('{{request.args.get("kc_id")}}');
    } else if ('{{request.args.get("slovo")}}'!="None"){
        load_sd_id();
    }

    init_click();
    init_tabs();

});


function DalsiTab(){
    $('.btnSave').focus();

    var selected = $(currentTab).attr('id');

    if (selected == "zakladne"){
        activateTab("rodicia-tab");
    } else if (selected == "rodicia"){
        activateTab("slova-tab");
    }
    else{
        ZmenSlovaSD(true);
    }
}

</script>